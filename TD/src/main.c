#include "memfuncs.h"

#include "stm32l475xx.h"

#include "button.h"
#include "clocks.h"
#include "irq.h"
#include "led.h"
#include "matrix.h"
#include "uart.h"
#include "timer.h"

uint8_t colors[192] =	{
0x00, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x3d, 0x00, 0x00, 0x62, 0x00, 0x00, 0x91, 0x00, 0x00, 0xc4, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0a, 0x08, 0x00, 0x1e, 0x18, 0x00, 0x3d, 0x2e, 0x00, 0x62, 0x4c, 0x00, 0x91, 0x6f, 0x00, 0xc4, 0x97, 0x00, 0xff, 0xc4, 0x00, 0x00, 0x00, 0x00, 0x02, 0x0a, 0x00, 0x04, 0x1e, 0x00, 0x08, 0x3d, 0x00, 0x0c, 0x62, 0x00, 0x12, 0x91, 0x00, 0x18, 0xc4, 0x00, 0x1e, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0a, 0x04, 0x00, 0x1e, 0x0c, 0x00, 0x3d, 0x18, 0x00, 0x62, 0x26, 0x00, 0x91, 0x38, 0x00, 0xc4, 0x4c, 0x00, 0xff, 0x62, 0x00, 0x00, 0x00, 0x00, 0x04, 0x0a, 0x00, 0x0c, 0x1e, 0x00, 0x18, 0x3d, 0x00, 0x26, 0x62, 0x00, 0x38, 0x91, 0x00, 0x4c, 0xc4, 0x00, 0x62, 0xff, 0x00, 0x00, 0x00, 0x02, 0x00, 0x0a, 0x04, 0x00, 0x1e, 0x08, 0x00, 0x3d, 0x0c, 0x00, 0x62, 0x12, 0x00, 0x91, 0x18, 0x00, 0xc4, 0x1e, 0x00, 0xff, 0x00, 0x00, 0x00, 0x0a, 0x00, 0x08, 0x1e, 0x00, 0x18, 0x3d, 0x00, 0x2e, 0x62, 0x00, 0x4c, 0x91, 0x00, 0x6f, 0xc4, 0x00, 0x97, 0xff, 0x00, 0xc4, 0x00, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x3d, 0x00, 0x00, 0x62, 0x00, 0x00, 0x91, 0x00, 0x00, 0xc4, 0x00, 0x00, 0xff, 0x00, 0x00 
};

void display_static_image(const rgb_color * leds);

int main(void)	{
	clocks_init();
	uart_init();
//	irq_init();
//	button_init();
//	led_init();
//	timer_init(1000000);
	matrix_init();

	rgb_color leds[64];
	const uint8_t * cur = colors;
	for(int i = 0; i < 64; ++i)	{
		leds[i].r = *cur++;
		leds[i].g = *cur++;
		leds[i].b = *cur++;
	}

	while(1)	{
		display_static_image(leds);
	}
}

void display_static_image(const rgb_color * leds)	{
	for(int i = 0; i < 8; ++i)	{
		mat_set_row(i, leds + i * 8);
		deactivate_rows();
	}
}
